!function(t){var e={secondly:1e3,minutely:6e4,quarterly:9e5,hourly:36e5,daily:864e5,weekly:6048e5},n=function(t){this.options=t||{},this.track=this.options.history||[],this.rules=[];for(var n in e)e.hasOwnProperty(n)&&n in this.options&&this[n](this.options[n])};n.prototype.whensNext=function(){return this._process().delay},n.prototype.push=function(t,e){var n=this.whensNext(),i=this;if(!this.rules.length)throw{name:"RuleError",message:"there are no defined rules"};return"function"==typeof e&&e(n)===!1?!1:(this.track.push(Date.now()+n),{delay:n,timer:setTimeout(function(){"function"==typeof i.options.onCall&&i.options.onCall(n),t()},n)})},n.prototype._process=function(){var t=function(t,e,n){for(var i=Date.now(),r=0,o=e.length;o>r;r++)!function(e){var r=e(i,n);t.delay<r.delay&&(t.delay=r.delay),(!("spliceIdx"in t)||t.spliceIdx>r.spliceIdx)&&(t.spliceIdx=r.spliceIdx)}(e[r]);return t}({delay:0},this.rules,this.track);return"spliceIdx"in t&&t.spliceIdx>0&&("function"==typeof this.options.onClear&&this.options.onClear(this.track[t.spliceIdx]),this.track.splice(0,t.spliceIdx)),t},n.prototype._bsearch=function(t){for(var e=0,n=this.track.length;n>e;){var i=e+n>>>1;this.track[i]<t?e=i+1:n=i}return e},n.prototype.within=function(t,e){var n=this;return this.register(function(i,r){var o=i-t,s=n._bsearch(o),u=r.length-s,h=u>=e?r[s+(u-e)]+t-i:0;return{delay:h,spliceIdx:s}}),this};for(var i in e)e.hasOwnProperty(i)&&!function(t,e){n.prototype[t]=function(t){return this.within(e,t)}}(i,e[i]);n.prototype.register=function(t){return this.rules.push(t),this};var r=function(t){return new n(t)};r.RuleChain=n,"undefined"!=typeof module&&module.exports?module.exports=r:"undefined"!=typeof define&&define.amd?define([],function(){return r}):t.limits=r}(this);